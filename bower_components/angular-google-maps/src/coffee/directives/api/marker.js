// Generated by CoffeeScript 1.7.1
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

angular.module("google-maps.directives.api").factory("Marker", [
  "IMarker", "MarkerParentModel", "MarkerManager", "CtrlHandle", function(IMarker, MarkerParentModel, MarkerManager, CtrlHandle) {
    var Marker;
    return Marker = (function(_super) {
      __extends(Marker, _super);

      function Marker($timeout) {
        this.link = __bind(this.link, this);
        Marker.__super__.constructor.call(this, $timeout);
        this.template = '<span class="angular-google-map-marker" ng-transclude></span>';
        this.$log.info(this);
      }

      Marker.prototype.controller = [
        '$scope', '$element', function($scope, $element) {
          $scope.ctrlType = 'Marker';
          return CtrlHandle.handle($scope, $element);
        }
      ];

      Marker.prototype.link = function(scope, element, attrs, ctrl) {
        var doFit;
        Marker.__super__.link.call(this, scope, element, attrs, ctrl);
        if (scope.fit) {
          doFit = true;
        }
        return this.mapPromise(scope, ctrl).then((function(_this) {
          return function(map) {
            if (!_this.gMarkerManager) {
              _this.gMarkerManager = new MarkerManager(map);
            }
            new MarkerParentModel(scope, element, attrs, map, _this.$timeout, _this.gMarkerManager, doFit);
            return scope.deferred.resolve();
          };
        })(this));
      };

      return Marker;

    })(IMarker);
  }
]);
